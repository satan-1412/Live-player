<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OSB PLAYER | LIVE</title>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="referrer" content="no-referrer">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* ================== V4.0 视觉修复 ================== */
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #fff;
            --text-sub: #aaa;
            --accent: #00ff88; /* 正常模式：极客绿 */
            --gap: 15px;
        }

        /* 成人模式配色 */
        body.root-mode {
            --bg-color: #2a0a18; /* 深红黑 */
            --card-bg: #3d1020;
            --accent: #ff0055; /* 霓虹粉 */
            --text-main: #xffddee;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden;
            transition: background-color 0.5s;
        }

        /* 顶部导航 */
        header {
            padding: 10px 15px;
            background: rgba(30,30,30,0.9);
            display: flex; align-items: center; gap: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 50;
        }

        .logo {
            font-size: 20px; font-weight: 900; color: var(--accent);
            letter-spacing: -1px; white-space: nowrap;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: 0.3s;
        }

        .search-box {
            flex: 1; position: relative;
        }
        .search-input {
            width: 100%; background: #333; border: none;
            border-radius: 6px; padding: 8px 10px 8px 30px;
            color: #fff; font-size: 14px;
        }
        .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #777; font-size: 12px; }

        /* 内容区域 */
        #main-container {
            flex: 1; display: flex; flex-direction: column; overflow: hidden;
        }

        /* 分类栏 (横向滚动) */
        #nav-scroll {
            padding: 10px 15px; display: flex; gap: 10px;
            overflow-x: auto; white-space: nowrap;
            background: var(--bg-color);
            scrollbar-width: none; /* Firefox 隐藏滚动条 */
        }
        #nav-scroll::-webkit-scrollbar { display: none; } /* Chrome 隐藏滚动条 */

        .nav-btn {
            padding: 6px 14px; border-radius: 20px;
            background: rgba(255,255,255,0.1); color: #ccc;
            border: none; font-size: 13px;
        }
        .nav-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        /* ======== 核心修复：宫格布局 ======== */
        #channel-grid {
            flex: 1; padding: 15px; overflow-y: auto;
            display: grid;
            /* 手机端默认双列，每列自适应 */
            grid-template-columns: repeat(2, 1fr); 
            grid-auto-rows: max-content; /* 高度根据内容定 */
            gap: 15px; /* 间距 */
            align-content: start;
        }

        /* 电脑端适配：屏幕宽了就变多列 */
        @media (min-width: 768px) {
            #channel-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
        }

        .card {
            background: var(--card-bg); border-radius: 8px;
            overflow: hidden; position: relative;
            display: flex; flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: 0.2s;
        }
        .card:active { transform: scale(0.98); }

        /* 图片容器：固定比例 16:9，防止图片太高 */
        .card-img-wrap {
            width: 100%; aspect-ratio: 16/9; 
            background: #000; position: relative;
        }
        .card-img {
            width: 100%; height: 100%; object-fit: cover; /* 裁剪填满，不拉伸 */
            display: block; opacity: 1; transition: 0.3s;
        }
        
        /* 图片加载失败时的默认图标 */
        .card-icon-fallback {
            position: absolute; top:0; left:0; width:100%; height:100%;
            display: flex; align-items: center; justify-content: center;
            background: #222; color: #444; font-size: 30px;
        }

        .card-title {
            padding: 8px 10px; font-size: 13px; color: #ddd;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            text-align: center; background: rgba(0,0,0,0.2);
        }

        /* ======== 播放器 & 弹幕 ======== */
        #player-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100;
            display: none; flex-direction: column;
        }
        #player-modal.active { display: flex; }

        /* 视频区：占满剩余空间 */
        #video-stage {
            flex: 1; position: relative; display: flex; align-items: center; justify-content: center;
            background: #000; overflow: hidden;
        }
        video { width: 100%; height: 100%; max-height: 100%; }

        /* 弹幕层 */
        #danmaku-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 80%; /* 留出底部空间 */
            pointer-events: none; z-index: 20;
        }

        /* 顶部栏 */
        .player-header {
            position: absolute; top: 0; left: 0; width: 100%; height: 50px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            z-index: 30; display: flex; justify-content: space-between; align-items: center; padding: 0 15px;
        }
        .close-btn { color: #fff; font-size: 20px; padding: 10px; }
        .live-tag {
            color: red; font-size: 12px; font-weight: bold; border: 1px solid red;
            padding: 2px 6px; border-radius: 4px; background: rgba(0,0,0,0.5);
        }

        /* 底部控制栏：固定在底部，键盘弹起时由浏览器自动顶起 */
        .player-controls {
            width: 100%; background: #1a1a1a;
            padding: 10px; display: flex; align-items: center; gap: 10px;
            border-top: 1px solid #333; z-index: 40;
            padding-bottom: env(safe-area-inset-bottom); /* 适配 iPhone 底部黑条 */
        }
        
        .dm-input {
            flex: 1; height: 36px; border-radius: 18px; border: none;
            padding: 0 15px; background: #333; color: #fff; font-size: 14px;
        }
        .dm-send {
            width: 36px; height: 36px; border-radius: 50%;
            background: var(--accent); color: #000;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
        }

        /* 呼吸灯动画 */
        .triggering { animation: pulse 0.5s infinite; color: #fff !important; }
        @keyframes pulse { 50% { text-shadow: 0 0 15px var(--accent); } }

        /* 错误提示 */
        #debug-toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: #fff; padding: 15px; border-radius: 8px;
            text-align: center; display: none; z-index: 200; font-size: 14px; max-width: 80%;
        }
    </style>
</head>
<body>

<header>
    <div class="logo" id="logo-trigger">OSB<span style="font-size:12px;opacity:0.6">PRO</span></div>
    <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" id="search-input" placeholder="搜索频道...">
    </div>
</header>

<div id="main-container">
    <div id="nav-scroll"></div>
    <div id="channel-grid">
        <div style="grid-column:1/-1; text-align:center; padding:50px; color:#666;">
            <i class="fas fa-circle-notch fa-spin"></i> 系统加载中...
        </div>
    </div>
